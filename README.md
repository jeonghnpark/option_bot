# μ„ λ¬Όμµμ… μλ™λ§¤λ§¤ μ‹μ¤ν…

**Made by: λ°•μ •ν„ (jh70035@gmail.com)**

## ν”„λ΅μ νΈ κ°μ”

λ³Έ ν”„λ΅μ νΈλ” λ‹¨μν• λ§¤λ§¤ μ‹κ·Έλ„ μƒμ„±μ΄λ‚ μμµλ¥  μμΈ΅μ„ λ„μ–΄, μ‹¤μ  κ±°λμ μ „ κ³Όμ •μ„ μλ™ν™”ν•λ” κ²ƒμ„ λ©ν‘λ΅ ν•λ” Django κΈ°λ° μ„ λ¬Ό/μµμ… μλ™λ§¤λ§¤ μ‹μ¤ν…μ…λ‹λ‹¤. OpenAPIλ¥Ό ν†µν•΄ μ‹¤μ‹κ°„ μ‹μ¥ λ°μ΄ν„°λ¥Ό μμ§‘ν•κ³ , μ‚¬μ „μ— μ •μλ λ‹¤μ–‘ν• μ•κ³ λ¦¬μ¦ μ „λµμ— λ”°λΌ λ§¤λ§¤ κΈ°νλ¥Ό ν¬μ°©ν•©λ‹λ‹¤.

μ‹μ¤ν…μ€ μ „λµμ— λ”°λΌ μλ™μΌλ΅ μ£Όλ¬Έμ„ μ‹¤ν–‰ν•κ³ , κ±°λλ‚΄μ—­μ„ DBμ— μ €μ¥ν•κ³  μ‹¤μ‹κ°„μΌλ΅ ν¬μ§€μ…μ μ†μµ(P&L)μ„ μ¶”μ ν•©λ‹λ‹¤. μ΄ν›„, μ„¤μ •λ λ©ν‘ μμµ λ‹¬μ„±, μ†μ‹¤ ν•λ„ λ„λ‹¬, λλ” μ‹κ°„ κΈ°λ° μ΅°κ±΄ λ“± λ―Έλ¦¬ μ •μλ μ²­μ‚° μ΅°κ±΄μ΄ μ¶©μ΅±λλ©΄ ν¬μ§€μ…μ„ μλ™μΌλ΅ μ²­μ‚°ν•μ—¬ μ „μ²΄ κ±°λλ¥Ό λ§λ¬΄λ¦¬ν•©λ‹λ‹¤.

##  μ‹μ¤ν… μ•„ν‚¤ν…μ²

### μ£Όμ” κµ¬μ„± μ”μ†

- **Django μ›Ή ν”„λ μ„μ›ν¬**: λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„
- **PostgreSQL**: κ±°λ λ°μ΄ν„° λ° ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ μ €μ¥
- **WebSocket**: μ‹¤μ‹κ°„ μ‹μ¥ λ°μ΄ν„° μμ‹ 
- **Channels**: Django λΉ„λ™κΈ° μ²λ¦¬ λ° WebSocket 
- **FastAPI**: κ³ μ„±λ¥ API μ—”λ“ν¬μΈνΈ (λ³„λ„ λ¨λ“)
- **LSμ¦κ¶ OpenAPI**: μ‹μ¥ λ°μ΄ν„° λ° μ£Όλ¬Έ μ²λ¦¬

### μ• ν”λ¦¬μΌ€μ΄μ… κµ¬μ΅°

```
simple_trading/
β”β”€β”€ mysite/              # Django ν”„λ΅μ νΈ μ„¤μ •
β”β”€β”€ dashboard/           # μ‹μ¤ν… μƒνƒ λ¨λ‹ν„°λ§
β”β”€β”€ trading/             # κΈ°λ³Έ νΈλ μ΄λ”© κΈ°λ¥ λ° λ³€λ™μ„± λ¶„μ„
β”β”€β”€ order/               # μ£Όλ¬Έ μ²λ¦¬ λ° ν¬νΈν΄λ¦¬μ¤ κ΄€λ¦¬
β”β”€β”€ api_auth/            # API μΈμ¦ κ΄€λ¦¬
β”β”€β”€ src/                 # ν•µμ‹¬ νΈλ μ΄λ”© λ΅μ§
β”‚   β”β”€β”€ tr/              # LSμ¦κ¶ API λνΌ
β”‚   β””β”€β”€ mathematics/     # μν•™μ  λ¨λΈ (Black-Scholes λ“±)
β”β”€β”€ fastapi_app/         # FastAPI κΈ°λ° κ³ μ„±λ¥ API
β””β”€β”€ optimization/        # μ „λµ μµμ ν™” λ¨λ“
```

##  μ£Όμ” κΈ°λ¥

### 1. μ‹¤μ‹κ°„ μ‹μ¥ λ°μ΄ν„° μ²λ¦¬
- **μ£Όκ°„/μ•Όκ°„ μ‹μ¥ μ§€μ›**: μ½”μ¤ν”Ό200 μ„ λ¬Ό λ° μ λ ‰μ¤ μ•Όκ°„ μ‹μ¥
- **μ‹¤μ‹κ°„ νΈκ°€/μ²΄κ²° λ°μ΄ν„°**: WebSocketμ„ ν†µν• μ‹¤μ‹κ°„ λ°μ΄ν„° μμ‹ 
- **λ‹¤μ–‘ν• μƒν’ μ§€μ›**: μ„ λ¬Ό, μµμ…, μ£Όμ‹ λ“±

### 2. νΈλ μ΄λ”© μ „λµ

#### FlexSwitch μ „λµ μ‹λ¦¬μ¦
- **Buy Dip μ „λµ**: κ°€κ²© ν•λ½ μ‹ λ§¤μ μ§„μ…
- **Sell Dip μ „λµ**: κ°€κ²© ν•λ½ μ‹ λ§¤λ„ μ§„μ…  
- **Buy Peak μ „λµ**: κ°€κ²© μƒμΉ μ‹ λ§¤μ μ§„μ…
- **Sell Peak μ „λµ**: κ°€κ²© μƒμΉ μ‹ λ§¤λ„ μ§„μ…

#### λ³€λ™μ„± κΈ°λ° μ „λµ
- **λ³€λ™μ„± λ§¤λ„ μ „λµ**: λ‚΄μ¬λ³€λ™μ„± λ¶„μ„μ„ ν†µν• μµμ… λ§¤λ„
- **Black-Scholes λ¨λΈ**: μµμ… κ°€κ²© μ‚°μ • λ° κ·Έλ¦­μ¤ κ³„μ‚°
- **20-Delta λ³€λ™μ„± μ¶”μ **: μ‹¤μ‹κ°„ λ³€λ™μ„± λ¨λ‹ν„°λ§

### 3. ν¬νΈν΄λ¦¬μ¤ κ΄€λ¦¬
- **μ‹¤μ‹κ°„ PnL κ³„μ‚°**: ν¬μ§€μ…λ³„ μ†μµ μ‹¤μ‹κ°„ μ¶”μ 
- **μλ™ μ²­μ‚° μ‹μ¤ν…**: 
  - λ©ν‘ μμµλ¥  λ‹¬μ„± μ‹ μ²­μ‚°
  - μ‹κ°„ κΈ°λ° μ²­μ‚° (μµλ€ λ³΄μ  μ‹κ°„)
  - μ†μ‹¤ ν•λ„ κΈ°λ° μ²­μ‚°
- **λ¦¬μ¤ν¬ κ΄€λ¦¬**: ν¬μ§€μ… ν¬κΈ° μ ν• λ° μ„ν— κ΄€λ¦¬

### 4. λ°±κ·ΈλΌμ΄λ“ μ‘μ—… κ΄€λ¦¬
- **λΉ„λ™κΈ° μ „λµ μ‹¤ν–‰**: λ‹¤μ¤‘ μ „λµ λ™μ‹ μ‹¤ν–‰
- **μλ™ λ¨λ‹ν„°λ§**: ν¬νΈν΄λ¦¬μ¤ μƒνƒ μ‹¤μ‹κ°„ κ°μ‹
- **μ‘μ—… μ¤μΌ€μ¤„λ§**: μ •κΈ°μ μΈ λ°μ΄ν„° μμ§‘ λ° λ¶„μ„


## λ°μ΄ν„° λ¨λΈ

### ν•µμ‹¬ λ¨λΈ

#### Portfolio
```python
- portfolio_id: κ³ μ  ν¬νΈν΄λ¦¬μ¤ μ‹λ³„μ
- timestamp: μƒμ„± μ‹κ°„
- status: μƒνƒ (Active, Pending, Closed)
- pnl: μ‹¤ν„/λ―Έμ‹¤ν„ μ†μµ
- target_profit: λ©ν‘ μμµ
- strategy: μ‚¬μ©λ μ „λµ
- liquidation_condition: μ²­μ‚° μ΅°κ±΄
```

#### Trade
```python
- portfolio: ν¬νΈν΄λ¦¬μ¤ μ™Έλν‚¤
- order_id: μ£Όλ¬Έ λ²νΈ
- focode: μƒν’ μ½”λ“
- price: μ²΄κ²° κ°€κ²©
- volume: μλ‰
- direction: λ§¤μ/λ§¤λ„ κµ¬λ¶„
- multiplier: μΉμ
```

#### VolatilityData
```python
- date_time: λ°μ΄ν„° μ‹κ°„
- iv_20: 20-Delta λ‚΄μ¬λ³€λ™μ„±
- option_code: μµμ… μ½”λ“
- future_code: κΈ°μ΄μμ‚° μ½”λ“
- option_greeks: λΈνƒ€, κ°λ§, λ² κ°€, μ„Ένƒ€
```

## μ¤ν¬λ¦°μƒ·

### 1. μ‹μ¥ λ°μ΄ν„° λ¨λ‹ν„°λ§
- μ‹¤μ‹κ°„ μ‹μ„Έ, νΈκ°€, λ³€λ™μ„± λ“± μ‹μ¥ λ°μ΄ν„°λ¥Ό κ΄€μ°°ν•κ³  κΈ°νλ¥Ό ν¬μ°©ν•©λ‹λ‹¤.
![μ‹μ¥ λ°μ΄ν„° λ¨λ‹ν„°λ§](media/market_monitoring.png)

### 2. μ „λµ κµ¬μ„± λ° μ£Όλ¬Έ
- λ‹¤μ–‘ν• μ „λµ(FlexSwitch, λ³€λ™μ„±)μ„ μ„¤μ •ν•κ³  μ£Όλ¬Έμ„ μ‹¤ν–‰ν•©λ‹λ‹¤.
![μ „λµ κµ¬μ„± λ° μ£Όλ¬Έ](media/strategy_order.png)

### 3. ν¬νΈν΄λ¦¬μ¤ λ° μ†μµ(P/L) κ΄€λ¦¬
- μ²΄κ²°λ μ£Όλ¬Έ λ‚΄μ—­κ³Ό μ‹¤μ‹κ°„ μ†μµ(P/L), ν¬μ§€μ… μƒνƒ(λ€κΈ°/μ²­μ‚°)λ¥Ό μ¶”μ ν•©λ‹λ‹¤.
![ν¬νΈν΄λ¦¬μ¤ λ° μ†μµ κ΄€λ¦¬](media/portfolio.png)


## π”§ μ„¤μΉ λ° μ„¤μ •

### 1. ν™κ²½ μ„¤μ •

```bash
# κ°€μƒν™κ²½ μƒμ„±
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# μμ΅΄μ„± μ„¤μΉ
pip install -r requirements.txt
```

### 2. νμ΄μ¬ κ²½λ΅ μ„¤μ • (.pth νμΌ)

ν”„λ΅μ νΈμ `src` ν΄λ”μ™€ λ£¨νΈ ν΄λ”λ¥Ό νμ΄μ¬ κ²½λ΅μ— μ¶”κ°€ν•μ—¬ λ¨λ“μ„ μ¬λ°”λ¥΄κ² μΈμ‹μ‹ν‚¤κΈ° μ„ν•΄ `.pth` νμΌμ„ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤.

κ°€μƒν™κ²½μ `site-packages` λ””λ ‰ν† λ¦¬ μ•μ— `_custom_paths.pth`μ™€ κ°™μ€ νμΌμ„ μƒμ„±ν•κ³ , μ•„λμ™€ κ°™μ΄ ν”„λ΅μ νΈμ **μ λ€ κ²½λ΅**λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.

- **`site-packages` κ²½λ΅ μμ‹**:
  - Windows: `.venv\Lib\site-packages\`
  - macOS/Linux: `.venv/lib/pythonX.X/site-packages/`

- **`.pth` νμΌ λ‚΄μ© μμ‹** (`D:\dev\option_bot`μ— ν”„λ΅μ νΈκ°€ μλ” κ²½μ°):
  ```
  D:\dev\option_bot
  D:\dev\option_bot\src
  ```

μ„ μμ‹μ `D:\dev\option_bot` λ¶€λ¶„μ„ μμ‹ μ μ‹¤μ  ν”„λ΅μ νΈ κ²½λ΅λ΅ μμ •ν•μ—¬ μ‚¬μ©ν•μ„Έμ”.

### 3. ν™κ²½ λ³€μ μ„¤μ •

`.env` νμΌ μƒμ„±:
```env
# LSμ¦κ¶ OpenAPI ν‚¤ (ν…μ¤νΈ)
EBEST-OPEN-API-APP-KEY-FUTURES-TEST=your_app_key
EBEST-OPEN-API-SECRET-KEY-FUTURES-TEST=your_secret_key

# λ°μ΄ν„°λ² μ΄μ¤ μ„¤μ •
DATABASE_URL=postgresql://user:password@localhost:5432/trading_db

# Django μ„¤μ •
SECRET_KEY=your_secret_key
DEBUG=True
```

### 4. λ°μ΄ν„°λ² μ΄μ¤ μ„¤μ •

```bash
# λ§μ΄κ·Έλ μ΄μ… μ‹¤ν–‰
python manage.py makemigrations
python manage.py migrate

# κ΄€λ¦¬μ κ³„μ • μƒμ„±
python manage.py createsuperuser
```

### 5. μ„λ²„ μ‹¤ν–‰

```bash
# Django κ°λ° μ„λ²„
python manage.py runserver

# Uvicorn μ„λ²„ μ‹¤ν–‰ν–‰
uvicorn mysite.asgi:application --reload
```

## π“ μ‚¬μ©λ²•

### 1. λ€μ‹λ³΄λ“ μ ‘μ†
- λ©”μΈ λ€μ‹λ³΄λ“: `http://localhost:8000`
- κ΄€λ¦¬μ νμ΄μ§€: `http://localhost:8000/admin`

### 2. μ „λµ μ‹¤ν–‰

#### FlexSwitch μ „λµ μ‹μ‘
```bash
POST /order/start_flexswitch_strategy/
{
    "action": "start",
    "strategy_type": "buydip",
    "shcode": "105W5000",
    "period": "5",
    "threshold": "15",
    "buffer": "2",
    "interval": "1"
}
```

#### λ³€λ™μ„± μ „λµ μ‹¤ν–‰
```bash
POST /order/run_volatility_strategy/
```

### 3. ν¬νΈν΄λ¦¬μ¤ λ¨λ‹ν„°λ§
- ν¬νΈν΄λ¦¬μ¤ λ©λ΅: `/order/portfolios/`
- μ‹¤μ‹κ°„ μ¤νΈλ¦Ό: `/order/portfolio_stream/`

## API μ—”λ“ν¬μΈνΈ

### μ£Όμ” μ—”λ“ν¬μΈνΈ

| μ—”λ“ν¬μΈνΈ | λ©”μ†λ“ | μ„¤λ… |
|-----------|--------|------|
| `/` | GET | λ©”μΈ λ€μ‹λ³΄λ“ |
| `/order/portfolios/` | GET | ν¬νΈν΄λ¦¬μ¤ λ©λ΅ |
| `/order/start_flexswitch_strategy/` | POST | FlexSwitch μ „λµ μ‹μ‘/μ¤‘μ§€ |
| `/order/run_volatility_strategy/` | POST | λ³€λ™μ„± μ „λµ μ‹¤ν–‰ |
| `/order/check_strategy_status/` | GET | μ „λµ μ‹¤ν–‰ μƒνƒ ν™•μΈ |
| `/order/start_auto_liquidation_task/` | POST | μλ™ μ²­μ‚° μ‹μ‘ |
| `/trading/calc_spot_vol/` | POST | ν„λ¬Ό λ³€λ™μ„± κ³„μ‚° |

### WebSocket μ—”λ“ν¬μΈνΈ
- `/ws/futures/{shcode}/`: μ‹¤μ‹κ°„ μ„ λ¬Ό κ°€κ²© μ¤νΈλ¦Ό



## λ΅κΉ…

- **DEBUG**: μƒμ„Έν• μ‹¤ν–‰ μ •λ³΄
- **INFO**: μΌλ°μ μΈ μ‹¤ν–‰ μƒνƒ
- **WARNING**: μ£Όμκ°€ ν•„μ”ν• μƒν™©
- **ERROR**: μ¤λ¥ μƒν™©

λ΅κ·Έ νμΌ: `logs/debug_YYYYMMDD_HHMMSS.log`
